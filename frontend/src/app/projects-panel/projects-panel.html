<div class="projects-panel">
  <h2>Projects</h2>


  <!-- Architect: Create Project Form -->
  <div *ngIf="showCreateForm() && session.user()?.role === 'architect'" class="create-project-form">
    <input type="text" placeholder="Project title" [value]="newProjectTitle()" (input)="newProjectTitle.set($event.target.value)" [disabled]="creating()" />
    <select [value]="selectedClientId()" (change)="onClientSelect($event)" [disabled]="clientsLoading() || creating()">
      <option value="" disabled>Select client</option>
      <option *ngFor="let client of clients()" [value]="client._id">{{ client.name }} ({{ client.email }})</option>
    </select>
    <button (click)="submitCreateProject()" [disabled]="creating()">Create</button>
    <button (click)="cancelCreateProject()" [disabled]="creating()">Cancel</button>
    <span *ngIf="createError()" class="error">{{ createError() }}</span>
  </div>
  <button *ngIf="!showCreateForm() && session.user()?.role === 'architect' && !showEditorOnly()" class="create-project-btn" (click)="createNewProject()">Create New Project</button>

  <div *ngIf="loading()">Loading projects...</div>
  <div *ngIf="error()">{{ error() }}</div>

  <ul *ngIf="!loading() && !error() && projects().length && !showEditorOnly()">
    <li *ngFor="let project of projects()">
      <strong>{{ project.title }}</strong>
      <span *ngIf="project._id"> (ID: {{ project._id }})</span>

      <!-- Architect actions -->
      <ng-container *ngIf="session.user()?.role === 'architect'">
        <button (click)="editProject(project)">Edit</button>
        <button (click)="archiveProject(project)">Archive</button>
        <button (click)="deleteProject(project)">Delete</button>
      </ng-container>

      <!-- Client actions -->
      <ng-container *ngIf="session.user()?.role === 'client'">
        <button (click)="viewProject(project)">View</button>
        <button (click)="giveFeedback(project)">Feedback</button>
      </ng-container>
    </li>
  </ul>
  <div *ngIf="!loading() && !error() && !projects().length && !showEditorOnly()">
    No projects found.
  </div>

  <div style="flex: 1; display: flex; flex-direction: column;">
    <app-editor *ngIf="showEditorOnly()" style="height: 100%; width: 100%;"></app-editor>
  </div>
</div>
